
# ğŸš€ MCP SQL Server: Integre o Claude Desktop ao seu Banco de Dados
-- Claude SQL Bridge: Guia Definitivo para macOS & Windows


Este guia fornece o passo a passo unificado para configurar o **Model Context Protocol (MCP)**, permitindo que o Claude Desktop execute consultas SQL diretamente em instÃ¢ncias do **Microsoft SQL Server**.

## ğŸ“‹ 1. PrÃ©-requisitos (Ambos os Sistemas)

* **Claude Desktop** instalado.
* **Node.js (v18+)** instalado: NecessÃ¡rio para rodar o servidor MCP.
* **SQL Server** acessÃ­vel: Pode ser local, via Docker ou servidor remoto.
* **Conectividade:** Certifique-se de que a porta **1433** estÃ¡ aberta no firewall.

---

## ğŸ› ï¸ 2. InstalaÃ§Ã£o do Servidor MCP

Abra o terminal (Terminal no macOS ou PowerShell/CMD no Windows) e instale o conector globalmente:

```bash
npm install -g @modelcontextprotocol/server-mssql

```

> **Dica:** Verifique o local de instalaÃ§Ã£o do Node.js com o comando `which node` (macOS) ou `where node` (Windows) para usar no arquivo de configuraÃ§Ã£o.

---

## âš™ï¸ 3. ConfiguraÃ§Ã£o do Claude Desktop

O Claude Desktop utiliza um arquivo JSON para gerenciar os servidores. O conteÃºdo Ã© o mesmo, mas o local do arquivo muda conforme o sistema:

### Caminho do Arquivo:

* **macOS:** `~/Library/Application Support/Claude/claude_desktop_config.json`
* **Windows:** `%APPDATA%\Claude\claude_desktop_config.json`

### ConteÃºdo do JSON:

Copie e cole o cÃ³digo abaixo, ajustando os caminhos de acordo com seu usuÃ¡rio:

```json
{
  "mcpServers": {
    "sql-server": {
      "command": "node",
      "args": [
        "C:/Users/SEU_USUARIO/AppData/Roaming/npm/node_modules/@modelcontextprotocol/server-mssql/dist/index.js"
      ],
      "env": {
        "MSSQL_CONNECTION_STRING": "Server=SEU_IP,1433;Database=NOME_BANCO;User Id=sa;Password=SUA_SENHA;Encrypt=true;TrustServerCertificate=true;"
      }
    }
  }
}

```

*No **macOS**, o caminho em `args` costuma ser `/usr/local/lib/node_modules/...` ou similar.*

---

## ğŸ” 4. VerificaÃ§Ã£o de Logs e Troubleshooting

Se o Ã­cone de ferramenta (martelo) nÃ£o aparecer no Claude, verifique os logs para diagnosticar erros de conexÃ£o ou sintaxe.

### Como abrir a pasta de logs:

* **No macOS (Terminal):**
```bash
open ~/Library/Logs/Claude

```


* **No Windows (Executar/Win+R):**
```text
%USERPROFILE%\AppData\Local\Logs\Claude

```



**Arquivos principais:**

* `mcp-server-sql-server.log`: Registra falhas de login ou erros de rede do SQL.
* `claude_desktop.log`: Registra se o Claude conseguiu carregar o Node.js e o arquivo de configuraÃ§Ã£o.

---

## ğŸš€ 5. Executando Consultas

1. **Reinicie o Claude Desktop:** Essencial para carregar novas configuraÃ§Ãµes.
2. **PeÃ§a uma consulta:** "Claude, mostre os top 5 produtos da tabela dbo.PRODUTOS".
3. **Autorize o Acesso:** Uma janela de seguranÃ§a surgirÃ¡. Clique em **"Permitir uma vez"** ou **"Sempre permitir"**.
4. **Resultado:** O Claude exibirÃ¡ os dados formatados em tabela diretamente no chat.

---

## ğŸ’¡ Dicas de Ouro (Checklist)

* **Sintaxe JSON:** No VS Code, verifique se nÃ£o hÃ¡ erros de "End of file expected". O arquivo deve terminar com um fechamento de chave `}` limpo.
* **SeguranÃ§a SQL:** Se usar SQL Server local sem certificado SSL oficial, o parÃ¢metro `TrustServerCertificate=true;` na string de conexÃ£o Ã© obrigatÃ³rio para evitar erros de handshake.
* **Teste de Rede:** Use `nc -zv IP 1433` (macOS) ou `Test-NetConnection IP -Port 1433` (Windows) para garantir que o banco estÃ¡ alcanÃ§Ã¡vel.

---

# LimitaÃ§Ãµes do MCP SQL Server

LimitaÃ§Ãµes do Model Context Protocol (MCP) ao conectar-se com SQL Server atravÃ©s do Claude AI.

## ğŸ“‹ Ãndice

- [OperaÃ§Ãµes Suportadas](#operaÃ§Ãµes-suportadas)
- [LimitaÃ§Ãµes](#limitaÃ§Ãµes)
- [PermissÃµes e SeguranÃ§a](#permissÃµes-e-seguranÃ§a)
- [Alternativas para OperaÃ§Ãµes Restritas](#alternativas-para-operaÃ§Ãµes-restritas)

## âœ… OperaÃ§Ãµes Suportadas

### Consultas e Leitura de Dados

- ExecuÃ§Ã£o de comandos `SELECT` em tabelas, views e funÃ§Ãµes
- JOINs complexos e subconsultas
- Consultas ao `INFORMATION_SCHEMA` e `sys.objects`
- ExecuÃ§Ã£o de stored procedures de leitura
- Uso de funÃ§Ãµes escalares e de tabela

### ModificaÃ§Ãµes de Dados (DML)

- `INSERT`, `UPDATE`, `DELETE`
- `MERGE` e operaÃ§Ãµes complexas de manipulaÃ§Ã£o de dados
- Gerenciamento de transaÃ§Ãµes:
  - `BEGIN TRANSACTION`
  - `COMMIT`
  - `ROLLBACK`

### DefiniÃ§Ã£o de Dados (DDL)

- `CREATE`, `ALTER`, `DROP` de:
  - Tabelas
  - Views
  - Ãndices
  - Stored procedures
  - Functions
- Gerenciamento de constraints e triggers

### AnÃ¡lise e Metadata

- Consulta de estruturas de banco de dados
- VerificaÃ§Ã£o de estatÃ­sticas e performance
- AnÃ¡lise de planos de execuÃ§Ã£o (`SET STATISTICS`)
- InspeÃ§Ã£o de schemas e objetos do banco

## âŒ LimitaÃ§Ãµes

### 1. OperaÃ§Ãµes de Arquivo

**NÃ£o suportado:**
- `BACKUP DATABASE` / `RESTORE DATABASE`
- Acesso ao sistema de arquivos do servidor
- Comandos como `xp_cmdshell`
- `OPENROWSET` com arquivos
- CriaÃ§Ã£o ou leitura de arquivos `.bak`, `.csv`, `.txt` no servidor
- `BULK INSERT` de arquivos externos
- ImportaÃ§Ã£o/exportaÃ§Ã£o de dados para arquivos fÃ­sicos

### 2. OperaÃ§Ãµes de Sistema

**Limitado ou nÃ£o suportado:**
- Gerenciamento completo de logins e usuÃ¡rios
- ConfiguraÃ§Ãµes de servidor (`sp_configure`)
- Linked servers
- ReplicaÃ§Ã£o e espelhamento de banco de dados
- SQL Server Agent Jobs e agendamentos

### 3. LimitaÃ§Ãµes de Rede e Performance

- **Timeout**: 15 segundos por consulta
- Sem transferÃªncia de arquivos binÃ¡rios pela conexÃ£o
- Sem acesso direto ao sistema de arquivos do servidor
- ConexÃ£o TCP/IP na porta padrÃ£o 1433

### 4. Comandos Administrativos AvanÃ§ados

**Restritos:**
- Alguns comandos `DBCC` (manutenÃ§Ã£o avanÃ§ada)
- OperaÃ§Ãµes que requerem permissÃµes `sysadmin` especÃ­ficas
- AlteraÃ§Ãµes em databases de sistema (`master`, `msdb`, `model`, `tempdb`)

## ğŸ” PermissÃµes e SeguranÃ§a

As limitaÃ§Ãµes dependem das **permissÃµes do usuÃ¡rio** configurado na conexÃ£o MCP.

### Verificar PermissÃµes Atuais

```sql
-- Ver todas as permissÃµes do usuÃ¡rio atual
SELECT * FROM fn_my_permissions(NULL, 'DATABASE');

-- Ver roles do usuÃ¡rio
SELECT 
    r.name AS role_name,
    m.name AS member_name
FROM sys.database_role_members AS drm
JOIN sys.database_principals AS r ON drm.role_principal_id = r.principal_id
JOIN sys.database_principals AS m ON drm.member_principal_id = m.principal_id
WHERE m.name = USER_NAME();
```

### Aumentar PermissÃµes (Se NecessÃ¡rio)

#### Para Permitir Backups via T-SQL

```sql
-- Conceder permissÃ£o de backup ao usuÃ¡rio
USE master;
GO
GRANT BACKUP DATABASE TO [seu_usuario];
GRANT BACKUP LOG TO [seu_usuario];
GO
```

#### Para OperaÃ§Ãµes de Arquivo (âš ï¸ Risco de SeguranÃ§a)

```sql
-- Habilitar xp_cmdshell (use com EXTREMA cautela!)
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
```

> âš ï¸ **AtenÃ§Ã£o**: Habilitar `xp_cmdshell` representa riscos significativos de seguranÃ§a. Use apenas em ambientes controlados e de desenvolvimento.

#### Para OperaÃ§Ãµes DDL Completas

```sql
-- Adicionar usuÃ¡rio ao role db_ddladmin
USE [seu_banco];
GO
ALTER ROLE db_ddladmin ADD MEMBER [seu_usuario];
GO
```

## ğŸ”„ Alternativas para OperaÃ§Ãµes Restritas

### Backup de Dados

Como nÃ£o Ã© possÃ­vel criar arquivos `.bak` diretamente atravÃ©s do MCP, utilize estas alternativas:

#### 1. Scripts SQL de INSERT

Melhor para migraÃ§Ã£o entre servidores diferentes:

```sql
-- Gerar script completo com estrutura e dados
-- (ideal para versionamento e migraÃ§Ã£o)
```

**Vantagens:**
- PortÃ¡vel entre diferentes versÃµes do SQL Server
- VersionÃ¡vel no Git
- FÃ¡cil de revisar e modificar

#### 2. ExportaÃ§Ã£o para JSON

```sql
-- Exportar dados em formato JSON
SELECT * FROM tabela
FOR JSON AUTO, INCLUDE_NULL_VALUES;
```

#### 3. ExportaÃ§Ã£o para CSV (via cÃ³digo)

Processar resultados e formatar como CSV atravÃ©s de scripts.

#### 4. Backup Manual no Servidor

Para backups binÃ¡rios completos (`.bak`), execute diretamente no servidor:

```sql
BACKUP DATABASE [NomeDoBanco] 
TO DISK = 'C:\Backups\NomeDoBanco.bak'
WITH FORMAT, 
     MEDIANAME = 'SQLServerBackups',
     NAME = 'Full Backup';
```

### OperaÃ§Ãµes de Sistema

Para configuraÃ§Ãµes de sistema e jobs agendados:
- Use SQL Server Management Studio (SSMS)
- Utilize Azure Data Studio
- Acesse diretamente o servidor via RDP ou console

## ğŸ“Š Casos de Uso Ideais

O MCP SQL Server Ã© ideal para:

- âœ… AnÃ¡lise exploratÃ³ria de dados
- âœ… Consultas ad-hoc e relatÃ³rios
- âœ… ModificaÃ§Ãµes de dados (INSERT, UPDATE, DELETE)
- âœ… CriaÃ§Ã£o e manutenÃ§Ã£o de estruturas (DDL)
- âœ… ExtraÃ§Ã£o de dados para migraÃ§Ã£o
- âœ… AnÃ¡lise de performance e otimizaÃ§Ã£o
- âœ… GeraÃ§Ã£o de scripts de banco de dados

## ğŸš« NÃ£o Recomendado Para

- âŒ Backups binÃ¡rios completos do banco
- âŒ OperaÃ§Ãµes que requerem acesso ao sistema de arquivos
- âŒ ConfiguraÃ§Ãµes avanÃ§adas de servidor
- âŒ Gerenciamento de infraestrutura
- âŒ OperaÃ§Ãµes que exigem mais de 15 segundos

## ğŸ“ Notas Adicionais

- O MCP conecta-se via TCP/IP na porta padrÃ£o 1433
- Requer credenciais vÃ¡lidas de SQL Server Authentication ou Windows Authentication
- Todas as operaÃ§Ãµes respeitam as permissÃµes configuradas para o usuÃ¡rio
- TransaÃ§Ãµes sÃ£o suportadas e devem ser usadas para garantir integridade dos dados

## ğŸ¤ ContribuiÃ§Ãµes

Sinta-se Ã  vontade para contribuir com este documento reportando limitaÃ§Ãµes adicionais ou sugerindo melhorias.

---


ğŸ“ Contato
Alexandre
alemiti@gmail.com
ğŸ˜Š

---
